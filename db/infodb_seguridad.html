<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base de Datos - Seguridad</title>
    <link rel="stylesheet" href="../styles/styles.css">
</head>
<body>
    <div class="container">
        <a href="./../modulos_individuales/Seguridad.html">[Seguridad]</a>

        <h1>Diseño de la base de datos del Módulo</h1>

        <h2>Diagrama de la base de datos</h2>
        <img src="./../assets/TBD_seguridad.png" alt="Diagrama de la base de datos" width="500">

        <h2>Descripción de Pertinencia de la Arquitectura de la Base de Datos</h2>

        <h3>Tabla usuarios</h3>
        <ul>
            <li><strong>Id_usuario:</strong> <code>tipo de dato</code>. Es el identificador único del usuario y la clave primaria de la tabla. El sistema lo utiliza para diferenciar a cada persona, sin importar si tienen el mismo nombre.</li>
            <li><strong></strong> <code>tipo de dato</code>. </li>
            <li><strong></strong> <code>tipo de dato</code>. </li>
            <li><strong>:</strong> <code>tipo de dato</code>. </li>
            <li><strong>:</strong> <code>tipo de dato</code>. </li>
            <li><strong>:</strong> <code>tipo de dato</code>. </li>
            <li><strong>:</strong> <code>tipo de dato</code>. </li>
            <li><strong>:</strong> <code>tipo de dato</code>. </li>
            <li><strong>:</strong> <code>tipo de dato</code>. </li>
        </ul>

        <h2>Normalización de la Base de Datos</h2>
        <p></p>
        
        <h3>1NF (Primera Forma Normal)</h3>
        <p>La 1NF se asegura de que cada columna de una tabla contenga un valor atómico (indivisible) y que no haya grupos de valores repetidos. Todas tus tablas ya cumplen con esta regla.
            <ul>
                <li><strong>usuarios:</strong>Cumple con 1NF. El nombre completo se ha dividido en <code>nombre</code>, <code>apellido_paterno</code> y <code>apellido_materno</code>, lo que hace que cada campo contenga un solo dato.</li>
                <li><strong>roles:</strong> Cumple con 1NF. Cada atributo, como <code>nombre_rol</code> y <code>descripcion</code>, tiene un valor único por registro.</li>
                <li><strong>usuario_rol:</strong> Cumple con 1NF. Cada fila representa una relación única entre un usuario y un rol.</li>
            </ul>
        </p>
        
        <h3>Segunda Forma Normal (2NF)</h3>
        <p>La 2NF exige que la tabla esté en 1NF y que todos los atributos no clave dependan de la clave primaria completa. Esto es relevante para tablas con claves primarias compuestas.
            <ul>
                <li><strong>usuarios</strong> Cumple con 2NF. Su clave primaria (<code>id_usuario</code>) es una sola columna. Por lo tanto, todos los atributos no clave (<code>nombre</code>, <code>contrasena_hash</code>, <code>email</code>, etc.) dependen de la clave completa.</li>
                <li><strong>roles:</strong> Cumple con 2NF. La clave primaria (<code>id_rol</code>) también es simple. Todos los atributos no clave dependen de <code>id_rol</code>.</li>
                <li><strong>usuario_rol:</strong> Cumple con 2NF. Aunque esta tabla relaciona a Usuarios y Roles, su clave primaria (<code>id_usuario_rol</code>) es simple. Los atributos <code>id_usuario</code> e <code>id_rol</code> son claves foráneas que dependen de sus respectivas tablas y no de la clave primaria de esta tabla, lo que asegura que no haya dependencias parciales.</li>
            </ul>
        </p>

        <h3>Tercera Forma Normal (3NF)</h3>
        <p>La 3NF requiere que la tabla esté en 2NF y que no existan dependencias transitivas. Una dependencia transitiva ocurre cuando un atributo no clave depende de otro atributo no clave, en lugar de la clave primaria.
            <ul>
                <li><strong>usaurios:</strong> Cumple con 3NF. Cada atributo no clave (<code>nombre</code>, <code>contrasena_hash</code>, etc.) depende directamente de la clave primaria <code>id_usuario</code>. Por ejemplo, el <code>email</code> de un usuario no depende del <code>nombre_usuario</code>, sino de su <code>id_usuario</code>.</li>
                <li><strong>roles:</strong> Cumple con 3NF. Los atributos no clave (<code>nombre_rol</code>, <code>descripcion</code>) dependen directamente de la clave primaria <code>id_rol</code>. La descripcion de un rol no depende de su <code>nombre_rol</code>, sino de su identificador único.</li>
                <li><strong>usuarios_rol:</strong> Cumple con 3NF. Los atributos <code>id_usuario</code> e <code>id_rol</code> son claves foráneas y no hay otros atributos no clave que puedan causar una dependencia transitiva. Esta tabla es puramente relacional y está diseñada para unir las tablas Usuarios y Roles de manera eficiente.</li>
            </ul>
        </p>
        
        <h2>Código SQL para crear la tabla usuarios</h2>
        <pre><code>
CREATE TABLE Roles (
    id_rol INT PRIMARY KEY,
    nombre_rol VARCHAR(50) UNIQUE,
    descripcion TEXT
);

-- Tabla de Usuarios
-- Almacena la información de cada persona con acceso al sistema.
CREATE TABLE Usuarios (
    id_usuario INT PRIMARY KEY,
    nombre VARCHAR(50),
    apellido_paterno VARCHAR(50),
    apellido_materno VARCHAR(50),
    nombre_usuario VARCHAR(50) UNIQUE,
    contrasena_hash VARCHAR(255),
    email VARCHAR(100) UNIQUE,
    fecha_creacion DATE,
    activo BIT
);

-- Tabla de Relación Usuario_Rol
-- Conecta a los usuarios con sus roles, permitiendo una relación de muchos a muchos.
CREATE TABLE Usuario_Rol (
    id_usuario_rol INT PRIMARY KEY,
    id_usuario INT,
    id_rol INT,
    FOREIGN KEY (id_usuario) REFERENCES Usuarios(id_usuario),
    FOREIGN KEY (id_rol) REFERENCES Roles(id_rol)
);
        </code></pre>

        <h2>Código SQL para agregar registros a las tabla</h2>

        <h3>Registros de la tabla usuarios</h3>
        <pre><code>
-- Insertar datos en la tabla Roles
-- Se definen los roles que tendrá el sistema.
INSERT INTO Roles (id_rol, nombre_rol, descripcion) VALUES
(1, 'Administrador', 'Control total del sistema'),
(2, 'Gerente', 'Gestión de reportes, inventario y personal'),
(3, 'Cajero', 'Registro de ventas y facturación'),
(4, 'Personal de cocina', 'Gestión de inventario de ingredientes');

-- Insertar datos en la tabla Usuarios
-- Se crean usuarios con sus credenciales y estado inicial.
-- Nota: 'contrasena_hash' es un valor ficticio. En un sistema real se usaría una función de hash.
-- 'activo' se usa 1 para verdadero y 0 para falso.
INSERT INTO Usuarios (id_usuario, nombre, apellido_paterno, apellido_materno, nombre_usuario, contrasena_hash, email, fecha_creacion, activo) VALUES
(1, 'Juan', 'Pérez', 'López', 'juanp', 'hash_ficticio_1', 'juan.p@cafeteria.com', '2025-09-22', 1),
(2, 'María', 'García', 'Sánchez', 'mariags', 'hash_ficticio_2', 'maria.g@cafeteria.com', '2025-09-22', 1),
(3, 'Carlos', 'Martínez', 'Ruiz', 'carlom', 'hash_ficticio_3', 'carlos.m@cafeteria.com', '2025-09-22', 1),
(4, 'Ana', 'Hernández', 'Díaz', 'anita_h', 'hash_ficticio_4', 'ana.h@cafeteria.com', '2025-09-22', 0); -- Usuario inactivo

-- Insertar datos en la tabla de relación Usuario_Rol
-- Se asignan roles a los usuarios creados.
-- Nota: un mismo usuario puede tener más de un rol si fuera necesario.
INSERT INTO Usuario_Rol (id_usuario_rol, id_usuario, id_rol) VALUES
(1, 1, 1), -- Juan Pérez es Administrador
(2, 2, 2), -- María García es Gerente
(3, 3, 3), -- Carlos Martínez es Cajero
(4, 4, 4), -- Ana Hernández es Personal de cocina (inactiva)
(5, 2, 3); -- María García también puede actuar como Cajera
        </code></pre>
    </div>
</body>
</html>